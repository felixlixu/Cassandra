package org.apache.cassandra.service;

import java.net.InetAddress;
import java.nio.ByteBuffer;
import java.util.ArrayList;
import java.util.List;

import org.apache.cassandra.config.DatabaseDescriptor;
import org.apache.cassandra.db.DecoratedKey;
import org.apache.cassandra.db.Table;
import org.apache.cassandra.dht.IPartitioner;
import org.apache.cassandra.gms.IEndpointStateChangeSubscriber;

public class StorageService implements IEndpointStateChangeSubscriber,StorageServiceMBean {

	private IPartitioner partitioner=DatabaseDescriptor.getPartitioner();
	private boolean isBootstrapMode;
	public static final StorageService instance=new StorageService();
	
	
	public static IPartitioner getPartitioner() {
		return instance.partitioner;
	}


	@Override
	public List<String> getLiveNodes() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public List<String> getUnreachableNodes() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public List<String> getJoinintNodes() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public List<String> getLeavingNodes() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public List<String> getMovingNodes() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public String getToken() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public String getReleaseVersion() {
		// TODO Auto-generated method stub
		return null;
	}


	public boolean isBootstrapMode() {
		
		return isBootstrapMode;
	}


	public List<InetAddress> getLiveNaturalEndpoints(String table,
			ByteBuffer key) {
		return getLiveNaturalEndpoints(table,partitioner.decorateKey(key));
	}


	public List<InetAddress> getLiveNaturalEndpoints(String table,
			RingPosition pos) {
		List<InetAddress> liveEps=new ArrayList<InetAddress>();
		List<InetAddress> endpoints=Table.open(table).getReplicationStrategy().getNaturalEndpoints(pos);
		
		for(InetAddress endpoint:endpoints){
			if(FailureDetector.instance.isAlive(endpoint)){
				liveEps.add(endpoint);
			}
		}
		return liveEps;
	}

}
