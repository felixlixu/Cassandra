package org.apache.cassandra.net;

import java.io.IOError;
import java.io.IOException;
import java.net.InetAddress;

import org.apache.cassandra.db.ReadVerbHandler;
import org.apache.cassandra.db.Row;
import org.apache.cassandra.gms.Gossiper;
import org.apache.cassandra.service.ReadCallback;
import org.apache.cassandra.service.RepairCallback;
import org.apache.cassandra.service.StorageService.Verb;

public class MessagingService implements MessagingServiceMBean {

	public static final int VERSION_11=4;
	public static final int version_=VERSION_11;
	
	private static final long DEFAULT_CALLBACK_TIMEOUT = DatabaseDescriptor.getRpcTimeout();
	
    private static class MSHandle
    {
        public static final MessagingService instance = new MessagingService();
    }
	
	public static MessagingService instance() {
		return MSHandle.instance;
	}

	public void registerVerbHandlers(Verb read, ReadVerbHandler readVerbHandler) {
		// TODO Auto-generated method stub
		
	}

	/**
	 * Send a message to a given endpoint.similar to sendRR
	 * */
	public String sendRR(MessageProducer producer, InetAddress to,
			IAsyncCallback cb) {
		try{
			return sendRR(producer.getMessage(Gossiper.instance.getVersion(to)),to,cb);
		}catch(IOException ex){
			throw new IOError(ex);
		}
	}

	private String sendRR(Message message, InetAddress to, IMessageCallback cb) {
		return sendRR(message, to, cb, DEFAULT_CALLBACK_TIMEOUT);
	}

}
